{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useState, useEffect, useRef } from 'react';\nimport { EmptyState, Layout, Page, Banner, Card, Heading, Frame, SkeletonBodyText, SkeletonDisplayText, SkeletonPage, TextContainer } from '@shopify/polaris';\nimport { TitleBar } from '@shopify/app-bridge-react';\nvar img = 'https://cdn.shopify.com/s/files/1/0757/9955/files/empty-state.svg';\n\nvar config = require('../server/config/httpConfig.js');\n\nimport axios from 'axios';\nimport { GET_SHOP_ID, CREATE_RECURRING } from '../server/config/appBasicQuery.js';\nimport { useQuery, useMutation } from 'react-apollo';\nimport '../client/css/AppStyle.css';\nimport Recommend from '../client/components/Recommend.js';\n\nfunction Index() {\n  _s();\n\n  var isInitialMount = useRef(true);\n\n  var _useMutation = useMutation(CREATE_RECURRING),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      recurr = _useMutation2[0];\n\n  var _useQuery = useQuery(GET_SHOP_ID),\n      errorID = _useQuery.error,\n      dataID = _useQuery.data;\n\n  var _useState = useState(true),\n      empty = _useState[0],\n      setEmpty = _useState[1];\n\n  var approve = useRef('block');\n\n  var _useState2 = useState(true),\n      pending = _useState2[0],\n      setPending = _useState2[1];\n\n  var _useState3 = useState(14),\n      freeTrial = _useState3[0],\n      setFreeTrial = _useState3[1];\n\n  var deadline = useRef(0);\n  useEffect(function () {\n    function redirectUser(_x, _x2) {\n      return _redirectUser.apply(this, arguments);\n    }\n\n    function _redirectUser() {\n      _redirectUser = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(day_install, day_un) {\n        var result;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                setPending(true);\n                approve.current = 'none';\n                _context.next = 4;\n                return recurr({\n                  variables: {\n                    name: \"Unlimited\",\n                    lineItems: [{\n                      plan: {\n                        appRecurringPricingDetails: {\n                          price: {\n                            amount: 9.95,\n                            currencyCode: \"USD\"\n                          }\n                        }\n                      }\n                    }],\n                    returnUrl: \"https://app.magicupsell.com/\",\n                    trialDays: 1\n                  }\n                });\n\n              case 4:\n                result = _context.sent;\n                axios.put(config.HTTP_API + '/store/' + config.ExtractId(dataID.shop.id), {\n                  confirm: result.data.appSubscriptionCreate.appSubscription.id\n                }).then(function (cc) {\n                  window.top.location = result.data.appSubscriptionCreate.confirmationUrl;\n                });\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return _redirectUser.apply(this, arguments);\n    }\n\n    function checkStatus() {\n      return _checkStatus.apply(this, arguments);\n    }\n\n    function _checkStatus() {\n      _checkStatus = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                axios.post(config.HTTP_API + '/store/search/status', {\n                  search: config.ExtractId(dataID.shop.id)\n                }).then(function (result) {\n                  if (result.data[0].confirm != null) {\n                    //new user\n                    axios.get(config.HTTP_API + '/charge/' + config.ExtractId(result.data[0].confirm)).then(function (dd) {\n                      if (dd.data.data.recurring_application_charge.status === 'active') {\n                        setPending(false);\n                      } else redirectUser();\n                    });\n                  } else {\n                    //old user\n                    if (result.data[0].status === 'ACTIVE') setPending(false);else redirectUser();\n                  }\n                });\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n      return _checkStatus.apply(this, arguments);\n    }\n\n    function getData() {\n      return _getData.apply(this, arguments);\n    }\n\n    function _getData() {\n      _getData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var db_data;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                db_data = {\n                  search: config.ExtractId(dataID.shop.id)\n                };\n                _context3.next = 3;\n                return axios.post(config.HTTP_API + '/store/search/mode', db_data).then(function (result) {\n                  result.data[0].upsell_mode ? setEmpty(false) : setEmpty(true);\n                });\n\n              case 3:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n      return _getData.apply(this, arguments);\n    }\n\n    function fetchData() {\n      return _fetchData.apply(this, arguments);\n    }\n\n    function _fetchData() {\n      _fetchData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if (!(isInitialMount.current && dataID)) {\n                  _context4.next = 6;\n                  break;\n                }\n\n                _context4.next = 3;\n                return checkStatus();\n\n              case 3:\n                isInitialMount.current = false;\n                _context4.next = 6;\n                return getData();\n\n              case 6:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n      return _fetchData.apply(this, arguments);\n    }\n\n    fetchData();\n  });\n  return __jsx(\"div\", null, __jsx(Page, null, !pending ? empty ? __jsx(EmptyState, {\n    heading: \"Boost your sales\",\n    action: {\n      content: 'Start',\n      url: '/faq-layout'\n    },\n    image: \"https://cdn.shopify.com/s/files/1/0757/9955/files/empty-state.svg\"\n  }, __jsx(\"p\", null, \"Read our \", __jsx(\"a\", {\n    href: \"/faq-layout\"\n  }, \"instruction\"), \" to set up your first upsell\")) : __jsx(\"div\", null, __jsx(\"header\", {\n    style: {\n      textAlign: \"center\",\n      padding: \"50px\"\n    }\n  }, __jsx(\"h1\", {\n    style: {\n      fontSize: \"2.5em\",\n      marginBottom: \"20px\"\n    }\n  }, \"Magic AI Post-Purchase Upsell\"), __jsx(\"p\", {\n    style: {\n      fontSize: \"1.5em\"\n    }\n  }, \"Increase your sales with our magic pop up...\")), __jsx(Banner, {\n    className: \"index-banner\",\n    title: \"We Got An update For Upsell Design!\",\n    status: \"info\"\n  }, __jsx(\"p\", null, \"You can now edit your button text in design page. Use your creative text in your language to get familiar with your customers! Please RE-ENABLE your the pop-up in order to use this new feature.\")), __jsx(Banner, {\n    className: \"index-banner\",\n    title: \"Conguatulation! Your upsell is now activated.\",\n    status: \"success\",\n    action: {\n      content: 'App setting',\n      url: '/annotated-layout'\n    }\n  }, __jsx(\"p\", null, \"You can start with design your upsell theme or create an attractive discount.\", __jsx(\"br\", null), \" We value feedback! It helps us make our product better and keeps us energized. Let us know how we're doing. \", __jsx(\"a\", {\n    href: \"https://apps.shopify.com/magic-ai-post-purchase-upsell\",\n    target: \"_blank\"\n  }, \"Review\"))), __jsx(\"br\", null), __jsx(Layout, null, __jsx(Layout.Section, {\n    oneThird: true\n  }, __jsx(Card, {\n    title: \"Design theme\",\n    secondaryFooterActions: [{\n      content: 'Start',\n      url: '/design-layout'\n    }]\n  }, __jsx(Card.Section, null, __jsx(\"p\", null, \"Create your own theme by using different colors to fit your store. Or set up a timer to attract your customers.\"), __jsx(\"br\", null), __jsx(\"p\", null, \"Your theme settings will be applied to both upsell mode.\"), __jsx(\"br\", null), __jsx(\"br\", null)))), __jsx(Layout.Section, {\n    oneThird: true\n  }, __jsx(Card, {\n    title: \"Report\",\n    secondaryFooterActions: [{\n      content: 'Analytics',\n      url: '/analytics-layout'\n    }]\n  }, __jsx(Card.Section, null, __jsx(\"p\", null, \"Create a report to find out how your upsell performed.\"), __jsx(\"br\", null), __jsx(\"p\", null, \"Daily, weekly or you can customize the date to create the report.\"), __jsx(\"br\", null), __jsx(\"br\", null), __jsx(\"br\", null)))), __jsx(Layout.Section, {\n    oneThird: true\n  }, __jsx(Card, {\n    title: \"Need help?\"\n  }, __jsx(Card.Section, null, __jsx(\"p\", null, \"Follow our \", __jsx(\"a\", {\n    href: \"/faq-layout\"\n  }, \"FAQ guide\"), \" to get started, additional help can be found here.\")), __jsx(Card.Section, null, __jsx(\"p\", null, \"Our team is always here to help with App installation and other issues. Feel free to reach us by email: support@smartecomtech.com\"), __jsx(\"br\", null), __jsx(\"p\", null, \"(Monday - Friday, 9am to 5pm)\"))))), __jsx(\"br\", null), __jsx(\"br\", null), __jsx(Recommend, null)) : __jsx(Frame, null, __jsx(SkeletonPage, {\n    title: \"Preparing...\"\n  }, __jsx(Layout, null, __jsx(Layout.Section, null, __jsx(Card, {\n    subdued: true\n  }, __jsx(Card.Section, null, __jsx(TextContainer, null, __jsx(SkeletonDisplayText, {\n    size: \"small\"\n  }), __jsx(SkeletonBodyText, {\n    lines: 2\n  }))), __jsx(Card.Section, null, __jsx(SkeletonBodyText, {\n    lines: 2\n  })))))))));\n}\n\n_s(Index, \"T5KD5ipbnn+6uH1x57QKen8jIWc=\", false, function () {\n  return [useMutation, useQuery];\n});\n\n_c = Index;\nexport default Index;\n\nvar _c;\n\n$RefreshReg$(_c, \"Index\");","map":{"version":3,"sources":["C:/Users/molek/OneDrive/Desktop/Work/Magic-Upsell/pages/index.js"],"names":["React","useState","useEffect","useRef","EmptyState","Layout","Page","Banner","Card","Heading","Frame","SkeletonBodyText","SkeletonDisplayText","SkeletonPage","TextContainer","TitleBar","img","config","require","axios","GET_SHOP_ID","CREATE_RECURRING","useQuery","useMutation","Recommend","Index","isInitialMount","recurr","errorID","error","dataID","data","empty","setEmpty","approve","pending","setPending","freeTrial","setFreeTrial","deadline","redirectUser","day_install","day_un","current","variables","name","lineItems","plan","appRecurringPricingDetails","price","amount","currencyCode","returnUrl","trialDays","result","put","HTTP_API","ExtractId","shop","id","confirm","appSubscriptionCreate","appSubscription","then","cc","window","top","location","confirmationUrl","checkStatus","post","search","get","dd","recurring_application_charge","status","getData","db_data","upsell_mode","fetchData","content","url","textAlign","padding","fontSize","marginBottom"],"mappings":"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","sourcesContent":["import React, { useState,useEffect,useRef } from 'react';\r\nimport {\r\n    EmptyState,\r\n    Layout, Page, Banner, Card, Heading, Frame,\r\n    SkeletonBodyText, SkeletonDisplayText, SkeletonPage,\r\n    TextContainer\r\n} from '@shopify/polaris';\r\nimport { TitleBar } from '@shopify/app-bridge-react';\r\nconst img = 'https://cdn.shopify.com/s/files/1/0757/9955/files/empty-state.svg';\r\nconst config = require('../server/config/httpConfig.js');\r\nimport axios from 'axios';\r\nimport {GET_SHOP_ID,CREATE_RECURRING} from '../server/config/appBasicQuery.js';\r\nimport { useQuery,useMutation } from 'react-apollo';\r\nimport '../client/css/AppStyle.css';\r\nimport Recommend from '../client/components/Recommend.js'\r\n\r\nfunction Index() {\r\n  const isInitialMount = useRef(true);\r\n  const [recurr] = useMutation(CREATE_RECURRING);\r\n  const {error:errorID, data:dataID} = useQuery(GET_SHOP_ID);\r\n  const [empty, setEmpty] = useState(true);\r\n  const approve = useRef('block');\r\n  const [pending, setPending] = useState(true);\r\n  const [freeTrial, setFreeTrial] = useState(14);\r\n  const deadline = useRef(0);\r\n\r\n  useEffect(() => {\r\n    async function redirectUser(day_install, day_un) {\r\n      setPending(true);\r\n      approve.current = 'none';\r\n      const result = await recurr({\r\n        variables:{\r\n          name: \"Unlimited\",\r\n          lineItems: [{\r\n            plan: {\r\n              appRecurringPricingDetails: {\r\n                  price: { amount: 9.95, currencyCode: \"USD\" }\r\n              }\r\n            }\r\n          }],\r\n          returnUrl: \"https://app.magicupsell.com/\",\r\n          trialDays: 1\r\n        }\r\n      });\r\n      axios.put(config.HTTP_API + '/store/' + config.ExtractId(dataID.shop.id), {confirm:result.data.appSubscriptionCreate.appSubscription.id}).then((cc)=>{window.top.location=result.data.appSubscriptionCreate.confirmationUrl;});\r\n    }\r\n\r\n    async function checkStatus() {\r\n      axios.post(config.HTTP_API + '/store/search/status', {search:config.ExtractId(dataID.shop.id)}).then(result => {\r\n       if(result.data[0].confirm != null){\r\n\t//new user\r\n          axios.get(config.HTTP_API +'/charge/'+config.ExtractId(result.data[0].confirm)).then((dd)=>{\r\n\t    if(dd.data.data.recurring_application_charge.status === 'active') {setPending(false);}\r\n\t    else redirectUser();\r\n          });\r\n\t}\r\n\telse {\r\n\t//old user\r\n\t   if(result.data[0].status === 'ACTIVE') setPending(false);\r\n\t   else redirectUser();\r\n\t}\r\n      });\r\n    }\r\n\r\n    async function getData() {\r\n      const db_data = {search:config.ExtractId(dataID.shop.id)};\r\n      await axios.post(config.HTTP_API + '/store/search/mode', db_data).then(result => {\r\n        result.data[0].upsell_mode ? setEmpty(false) : setEmpty(true);\r\n      });\r\n    }\r\n\r\n    async function fetchData() {\r\n      if (isInitialMount.current && dataID) {\r\n        await checkStatus();\r\n        isInitialMount.current = false;\r\n        await getData();\r\n      }\r\n    }\r\n\r\n    fetchData();\r\n  });\r\n  return(\r\n    <div>\r\n    <Page>\r\n    {!pending ?\r\n      empty ?\r\n      <EmptyState\r\n      heading=\"Boost your sales\"\r\n      action={{content: 'Start', url: '/faq-layout'}}\r\n      image=\"https://cdn.shopify.com/s/files/1/0757/9955/files/empty-state.svg\"\r\n      >\r\n      <p>Read our <a href=\"/faq-layout\">instruction</a> to set up your first upsell</p>\r\n      </EmptyState>\r\n      :\r\n      <div>\r\n\t<header style={{textAlign:\"center\",padding:\"50px\"}}>\r\n          <h1 style={{fontSize:\"2.5em\",marginBottom:\"20px\"}}>Magic AI Post-Purchase Upsell</h1>\r\n          <p style={{fontSize:\"1.5em\"}}>Increase your sales with our magic pop up...</p>\r\n \t</header>\r\n\t<Banner\r\n          className=\"index-banner\"\r\n          title=\"We Got An update For Upsell Design!\"\r\n          status=\"info\">\r\n          <p>You can now edit your button text in design page. Use your creative text in your language to get familiar with your customers! Please RE-ENABLE your the pop-up in order to use this new feature.</p>\r\n        </Banner>\r\n        <Banner\r\n          className=\"index-banner\"\r\n          title=\"Conguatulation! Your upsell is now activated.\"\r\n          status=\"success\"\r\n          action={{content: 'App setting', url: '/annotated-layout'}}>\r\n          <p>You can start with design your upsell theme or create an attractive discount.<br/> We value feedback! It helps us make our product better and keeps us energized. Let us know how we're doing. <a href=\"https://apps.shopify.com/magic-ai-post-purchase-upsell\" target=\"_blank\">Review</a></p>\r\n        </Banner>\r\n        <br/>\r\n        <Layout>\r\n          <Layout.Section oneThird>\r\n            <Card\r\n            title=\"Design theme\"\r\n            secondaryFooterActions={[{content: 'Start', url:'/design-layout'}]}\r\n            >\r\n              <Card.Section>\r\n                <p>Create your own theme by using different colors to fit your store. Or set up a timer to attract your customers.</p>\r\n                <br/>\r\n                <p>Your theme settings will be applied to both upsell mode.</p>\r\n                <br/><br/>\r\n              </Card.Section>\r\n            </Card>\r\n          </Layout.Section>\r\n          <Layout.Section oneThird>\r\n            <Card\r\n            title=\"Report\"\r\n            secondaryFooterActions={[{content: 'Analytics', url:'/analytics-layout'}]}\r\n            >\r\n              <Card.Section>\r\n                <p>Create a report to find out how your upsell performed.</p>\r\n                <br/>\r\n                <p>Daily, weekly or you can customize the date to create the report.</p>\r\n                <br/><br/><br/>\r\n              </Card.Section>\r\n            </Card>\r\n          </Layout.Section>\r\n          <Layout.Section oneThird>\r\n            <Card\r\n            title=\"Need help?\"\r\n            >\r\n            <Card.Section>\r\n              <p>Follow our <a href=\"/faq-layout\">FAQ guide</a> to get started, additional help can be found here.</p>\r\n            </Card.Section>\r\n            <Card.Section>\r\n              <p>Our team is always here to help with App installation and other issues. Feel free to reach us by email: support@smartecomtech.com</p>\r\n              <br/><p>(Monday - Friday, 9am to 5pm)</p>\r\n            </Card.Section>\r\n          </Card>\r\n          </Layout.Section>\r\n        </Layout>\r\n\t<br/>\r\n\t<br/>\r\n\t<Recommend/>\r\n      </div>\r\n      :\r\n      <Frame>\r\n        <SkeletonPage title=\"Preparing...\">\r\n          <Layout>\r\n            <Layout.Section>\r\n              <Card subdued>\r\n                <Card.Section>\r\n                  <TextContainer>\r\n                    <SkeletonDisplayText size=\"small\" />\r\n                    <SkeletonBodyText lines={2} />\r\n                  </TextContainer>\r\n                </Card.Section>\r\n                <Card.Section>\r\n                  <SkeletonBodyText lines={2} />\r\n                </Card.Section>\r\n              </Card>\r\n            </Layout.Section>\r\n          </Layout>\r\n        </SkeletonPage>\r\n    </Frame>\r\n    }\r\n    </Page>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Index;\r\n"]},"metadata":{},"sourceType":"module"}